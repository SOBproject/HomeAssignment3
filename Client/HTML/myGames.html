<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>
    <script src="../JS/ajaxcalls.js"></script>
    <link href="../CSS/gamelist.css" rel="stylesheet" />
    <title>Game Store</title>
</head>
<body>
    <h1>My Games:</h1>

    <div class="filter-container">
        <div>
            <label for="minPriceInput">Minimum Price Filter:</label>
            <input type="number" id="minPriceInput" min="0" step="1">
            <button onclick="filterByMinPrice()">Filter by Price</button>
        </div>
        <div>
            <label for="minRankInput">Minimum Rank Score Filter:</label>
            <input type="number" id="minRankInput" min="0" max="100" step="1">
            <button onclick="filterByMinRank()">Filter by Rank</button>
        </div>
        <div>
            <button onclick="loadGameList()">Reset Filters</button>
        </div>
    </div>

    <button onclick="window.location.href='index.html';">Go to Main Page</button>
    <div class="card-container" id="gamescontainer"></div>
    <script>
        const api = "https://localhost:7238/api/Games";

        $(document).ready(function () {
        
            loadGameList();
        });

        
        function loadGameList() {
            ajaxCall(
                "GET",
                api,
                "",
                function (gamelist) {
                    console.log("Games Loaded:", gamelist);
                    renderGameList(gamelist); 
                },
                function (error) {
                    console.error("Error loading games:", error);
                }
            );
        }
        function filterByMinPrice() {
            
            const minPrice = document.getElementById('minPriceInput').value;
            if (!minPrice) {
                alert('Please enter a minimum price');
                return;
            }


            ajaxCall(
                "GET",
                `${api}/minPrice?minPrice=${minPrice}`,
                "",
                function (filteredList) {
                    console.log("Filtered Games by Price:", filteredList);
                    renderGameList(filteredList);
                },
                function (error) {
                    console.error("Error filtering games by price:", error);
                }
            );
        }


        function filterByMinRank() {
            const minRank = document.getElementById('minRankInput').value;
            if (!minRank) {
                alert('Please enter a minimum rank score');
                return;
            }

            ajaxCall(
                "GET",
                `${api}/scoreRank/${minRank}`,
                "",
                function (filteredList) {
                    console.log("Filtered Games by Rank:", filteredList);
                    renderGameList(filteredList);
                },
                function (error) {
                    console.error("Error filtering games by rank:", error);
                }
            );
        }

       
        function renderGameList(gamelist) {
            const gamesContainer = document.getElementById("gamescontainer");
            gamesContainer.innerHTML = ""; 

            
            if (!gamelist || gamelist.length === 0) {
                gamesContainer.innerHTML = "<p>No games found.</p>";
                return;
            }

           
            gamelist.forEach((game, i) => {
                const card = document.createElement("div");
                card.classList.add("card");
                card.innerHTML = `
                          <img src="${game.Header_image}" alt="${game.Name}">
                          <h3>${game.Name}</h3>
                          <p><strong>Genres:</strong> ${game.Genres}</p>
                         <p><strong>Price:</strong> ${game.Price}</p>
                         <p><strong>Score Rank:</strong> ${game.scoreRank}</p>
                          <button class="DeleteBTN" data-id="${game.AppID}">Delete</button>`;
                gamesContainer.appendChild(card);
            });

            $(".DeleteBTN").on("click", function () {
                const gameId = $(this).data("id");
                deleteGame(gameId);
            });
        }

        function deleteGame(AppID) {

            const UrlToDelete = api + "/" + AppID;

            ajaxCall(
                "DELETE",
                UrlToDelete, 
                "",
                deleteGameSCB,
                deleteGameECB
            );
            console.log(`Delete request sent for Game ID: ${AppID}`);
        }

        function deleteGameSCB(status) {
            console.log("Delete Success:", status);
            loadGameList();
            renderGameList();
        }

        function deleteGameECB(error) {
            console.error("Error deleting game:", error);
            alert("Failed to delete the game. Please try again.");
        }

    </script>
</body>
</html>
